---
const modules = import.meta.glob('../content/newsletters/*.mdx', { eager: true }) as Record<string, { frontmatter?: Record<string, any> }>; // adjust extension/path if needed

function parsePath(p: string): string {
    const parts = p.split('/');
    const file = parts[parts.length - 1];
    return file.replace(/\.mdx?$/, '');
}

const posts = Object.entries(modules).map(([path, mod]) => {
    const fm = mod.frontmatter ?? {};
    return {
        title: fm.title ?? 'Untitled',
        date: fm.date ? new Date(fm.date) : new Date(0),
        summary: fm.summary ?? '',
        slug: parsePath(path),
    };
}).sort((a, b) => b.date.getTime() - a.date.getTime());

function formatDate(d: Date): string {
    if (!(d instanceof Date) || Number.isNaN(d.getTime())) return '';
    return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
}
---
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Archive</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <style>
            body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 2rem; max-width: 800px; margin: auto; }
            header { margin-bottom: 1.5rem; }
            .post { padding: 1rem 0; border-bottom: 1px solid #e6e6e6; }
            .meta { color: #6b6b6b; font-size: 0.9rem; }
            a { color: inherit; text-decoration: none; }
            a:hover { text-decoration: underline; }
        </style>
    </head>
    <body>
        <header>
            <h1>Archive</h1>
            <p class="meta">All past newsletters.</p>
        </header>

        <main>
            {posts.length === 0 ? (
                <p>No newsletters found. Place markdown/MDX files in src/content/newsletters/ with frontmatter (title, date, summary).</p>
            ) : (
                <section>
                    {posts.map(post => (
                        <article class="post" data-key={post.slug}>
                            <h2><a href={`/newsletters/${post.slug}`}>{post.title}</a></h2>
                            <div class="meta">{formatDate(post.date)}</div>
                            {post.summary && <p>{post.summary}</p>}
                        </article>
                    ))}
                </section>
            )}
        </main>
    </body>
</html>