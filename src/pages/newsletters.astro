
---
import Layout from '../layouts/Layout.astro'
export const prerender = true;

const API_BASE = import.meta.env.VITE_API_BASE_URL ?? 'http://localhost:3000';
let posts = [];
try {
	const res = await fetch(`${API_BASE}/posts`);
	if (res.ok) posts = await res.json();
	else posts = [];
} catch (e) {
	posts = [];
}
---

<Layout showHero={false}>
	<section class="max-w-7xl mx-auto px-6 py-16">
		<header class="mb-12 text-center">
			<h1 class="text-4xl font-serif font-medium text-white">All Newsletters</h1>
			<p class="text-gray-300 mt-3">Browse every edition â€” short, practical notes for builders.</p>
		</header>

		{posts && posts.length > 0 ? (
			<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
					{posts.map((post: any) => (
						<article class="group relative bg-white/80 dark:bg-zinc-900/80 rounded-2xl p-6 shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-200 dark:border-zinc-800">
							<a href={`/posts/${post.id}`} class="no-underline">
								<h2 class="text-xl font-serif text-white mb-2">{post.title}</h2>
							</a>
							<div class="text-sm text-gray-400 mb-4">{new Date(post.created_at).toLocaleDateString()}</div>
							<p class="text-gray-300 mb-6">{post.excerpt ?? 'Short summary not available.'}</p>
							<div class="flex items-center justify-between">
								<a href={`/posts/${post.id}`} class="text-sm text-amber-300 font-medium hover:underline">Read</a>
								<div class="text-xs text-gray-400">{post.readTime ?? '5 min'}</div>
							</div>
						</article>
					))}
			</div>
		) : (
			<div class="text-center text-gray-600">No newsletters found.</div>
		)}
	</section>
</Layout>

